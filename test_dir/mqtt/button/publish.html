<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MQTT Publish from Web</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
<h1>MQTT Publish from Web</h1>
<button id="publishButton">Publish Message</button>
<p id="status"></p>

    <script>
        // WebSocket エンドポイント
        const brokerUrl = 'wss://broker.hivemq.com:8884/mqtt';

        // MQTT クライアントの作成
        const client = mqtt.connect(brokerUrl);

        // 接続時のイベント
        client.on('connect', () => {
            console.log('Connected to MQTT broker');
            document.getElementById('status').innerText = 'Connected to MQTT broker';
        });

        // エラー時のイベント
        client.on('error', (err) => {
            console.error('Connection error:', err);
            document.getElementById('status').innerText = 'Connection error: ' + err.message;
        });

        // ボタンクリック時のイベント
        document.getElementById('publishButton').addEventListener('click', () => {
            const topic = 'testaa/topic'; // トピック名
            const message = 'Hello from Web Browser Feb/12/2025';

            // メッセージをパブリッシュ
            client.publish(topic, message, (err) => {
                if (!err) {
                    console.log('Message published');
                    document.getElementById('status').innerText = `Published: ${message} to ${topic}`;
                } else {
                    console.error('Publish error:', err);
                    document.getElementById('status').innerText = 'Publish error: ' + err.message;
                }
            });
        });
    </script>
<hr />
<p>Feb/12/2025</p>
</body>
</html>
